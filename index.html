<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DIAMO Gallery</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://raw.githubusercontent.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root{
      --bg-light:#f5f5f5;
      --text:#222;
      --text-inv:#fff;
      --primary:#555;
      --radius:18px;
      --speed:.28s;
      --container: min(2000px, 94vw);
      --gap: clamp(8px, 2vw, 24px);
      --card-min: clamp(120px, 28vw, 380px);
    }
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family:'Playfair Display',serif;
      color:var(--text); background:#fff; line-height:1.6; overflow-x:hidden;
      text-rendering:optimizeLegibility; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    a{color:inherit;text-decoration:none}
    .header{position:sticky;top:0;z-index:1000;background:var(--bg-light);backdrop-filter:saturate(150%) blur(6px)}
    .nav{width:var(--container);margin-inline:auto;display:flex;align-items:center;justify-content:space-between;padding:10px 2px}
    .logo{font-size:clamp(1.15rem, 2.6vw, 2rem);font-weight:700;letter-spacing:.02em}

    /* 왼쪽: 로고 + 언어 버튼 */
    .nav-left{
      display:flex;
      align-items:center;
      gap:16px; /* 로고와 언어 버튼 간격 */
    }

    .nav-links{list-style:none;display:flex;gap:14px}
    .nav-links a{padding:6px 10px;border-radius:8px;transition:background var(--speed)}
    .nav-links a:hover{background:rgba(0,0,0,.06)}

    .lang-switch{
      list-style:none;
      display:flex;
      gap:3px;
    }
    .lang-switch button{
      background:transparent;
      border:0;
      padding:6px 4px;
      border-radius:8px;
      cursor:pointer;
      font:inherit;
      color:inherit;
      transition:background var(--speed);
    }
    .lang-switch button:hover{
      background:rgba(0,0,0,.06);
    }
    .lang-switch button.active{
      background:rgba(0,0,0,.08);
    }

    .hero{background:#e9e9e9;text-align:center;padding:clamp(36px,8vw,120px) 16px}
    .hero h1{font-size:clamp(1.4rem, 5vw, 3.4rem);margin-bottom:8px}
    .hero p{font-size:clamp(.9rem, 2.2vw, 1.3rem);opacity:.85}
    .section{width:var(--container);margin-inline:auto;padding:clamp(18px,5vw,48px) 2px}
    .section h2{font-size:clamp(1.1rem,3vw,2rem);margin-bottom:12px}
    .projects-grid{display:grid;grid-template-columns: repeat(auto-fit, minmax(var(--card-min), 1fr));gap:var(--gap)}
    .project{
      background:transparent;border:none;border-radius:var(--radius);overflow:hidden;cursor:pointer;outline:none;box-shadow:none;transition:transform var(--speed);
      content-visibility:auto;
      contain-intrinsic-size:300px 225px;
    }
    .project:focus-visible{outline: 2px solid rgba(0,0,0,.22);outline-offset: 4px;border-radius: 14px}
    .thumb{width:100%;aspect-ratio: 4/3;object-fit:cover;display:block;transition:transform var(--speed) ease, filter var(--speed) ease, opacity .48s ease}
    .project-label{padding:10px 12px;font-weight:600;text-align:center;transition: transform .28s ease, opacity .28s ease;opacity:.95}
    .project:hover .thumb{transform: scale(1.04);filter: drop-shadow(0 8px 22px rgba(0,0,0,.18))}
    .project:hover .project-label{transform: translateY(-2px);opacity:1}
    .lightbox{position:fixed;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;background: radial-gradient(1200px 800px at 50% 50%, rgba(0,0,0,.88), rgba(0,0,0,.96));z-index:2000}
    .lightbox[aria-hidden="false"]{display:flex}
    .close-btn{position:fixed;top:12px;right:14px;z-index:2100;font-size:clamp(1.3rem, 3vw, 2.2rem);color:var(--text-inv);background:transparent;border:0;cursor:pointer;line-height:1}
    #lightbox-container{
      position:relative;
      aspect-ratio: 4 / 3;
      width: min(96vw, calc(88dvh * 4 / 3), 2200px);
      display:flex;align-items:center;justify-content:center;overflow:hidden;
      border-radius: clamp(8px, 1.2vw, 20px);
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
      outline:none;
      touch-action: pan-y;
      background: rgba(0,0,0,.1);
    }
    #lightbox-current,#lightbox-next{position:absolute;inset:auto;max-width:100%;max-height:100%;object-fit:contain;will-change:transform,opacity}
    .arrow{position:absolute;top:50%;transform:translateY(-50%);z-index:2050;background:rgba(0,0,0,.35);border:0;color:var(--text-inv);font-size:clamp(1.3rem, 3.8vw, 2.6rem);width:clamp(36px, 6vw, 60px);height:clamp(36px, 6vw, 60px);border-radius:50%;display:grid;place-items:center;cursor:pointer;transition:background var(--speed)}
    .arrow:hover{background:rgba(0,0,0,.5)}
    .arrow.left{left:10px}
    .arrow.right{right:10px}
    @media (pointer: coarse), (max-width: 640px){
      .arrow{display:none}
    }
    .dots{margin-top:10px;display:flex;gap:6px;overflow:auto;padding:4px 10px;max-width:var(--container)}
    .dots::-webkit-scrollbar{height:6px}
    .dots span{min-width:10px;height:10px;background:#888;border-radius:50%;cursor:pointer;transition:background var(--speed),transform var(--speed)}
    .dots span.active{background:#fff;transform:scale(1.15)}

    #contact-popup{position:fixed;bottom:20px;left:20px;z-index:1500;width:min(340px, 90vw);background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:14px;padding:14px;box-shadow:0 8px 28px rgba(0,0,0,.18);transform: translate(-120%, 120%);opacity:0;transition: transform .38s ease, opacity .38s ease}
    #contact-popup.open{transform:none;opacity:1}
    #contact-popup input,#contact-popup textarea{width:100%;margin-bottom:8px;padding:10px;border-radius:10px;border:1px solid #e6e6e6;font-size:1rem}
    #contact-popup button{width:100%;padding:10px 12px;border:0;color:#fff;background:var(--primary);border-radius:10px;cursor:pointer}
    #contact-popup button:hover{filter:brightness(.9)}
    .footer{background:var(--bg-light);text-align:center;padding:22px 0;margin-top:36px}
    .footer-copy{font-size:.95rem;color:#666}
    .footer-icons{position:fixed;left:20px;bottom:24px;display:flex;gap:12px;font-size:2.0rem;z-index:1200}
    .footer-icons a.instagram{background:linear-gradient(45deg,#f58529,#dd2a7b,#8134af,#515bd4);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .footer-icons a.blog{color:#1EC800}
    @media (max-width:520px){
      .footer-icons{position:static;margin:10px 0 0 20px}
      .close-btn{display:none}
    }
    .thumb.reveal{opacity:0;transform:scale(1.01)}
    .thumb.reveal.in{opacity:1;transform:none;transition:opacity .48s ease,transform .48s ease}
    @media (prefers-reduced-motion: reduce){
      *{transition:none !important;animation:none !important}
      .thumb.reveal{opacity:1;transform:none}
      .project:hover .thumb{transform:none;filter:none}
      .project:hover .project-label{transform:none}
    }
    html{scrollbar-gutter:stable}
    *{scrollbar-width:thin;scrollbar-color:rgba(0,0,0,0.18) transparent}
    *::-webkit-scrollbar{width:8px;height:8px}
    *::-webkit-scrollbar-track{background:transparent}
    *::-webkit-scrollbar-thumb{background:linear-gradient(180deg,rgba(0,0,0,0.16),rgba(0,0,0,0.12));border-radius:999px;border:2px solid rgba(255,255,255,0.8)}
    *::-webkit-scrollbar-thumb:hover{background:linear-gradient(180deg,rgba(0,0,0,0.22),rgba(0,0,0,0.18))}
    .lightbox *::-webkit-scrollbar-thumb{background:linear-gradient(180deg,rgba(255,255,255,0.35),rgba(255,255,255,0.28));border:2px solid rgba(0,0,0,0.15)}
    .lightbox *{scrollbar-color:rgba(255,255,255,0.35) transparent}
    .dots{scrollbar-width:thin}
    .dots::-webkit-scrollbar-thumb{border-width:1px}
    #popup-permission[hidden]{display:none}
    #popup-permission{
      position:fixed;left:0;right:0;bottom:0;z-index:2500;
      background:rgba(20,20,20,.92);color:#fff;
      padding:14px 18px; box-shadow:0 -8px 24px rgba(0,0,0,.25);
    }
    #popup-permission .pp-wrap{max-width:var(--container);margin:0 auto}
    #popup-permission strong{display:block;font-size:1.05rem;margin-bottom:6px}
    #popup-permission p{font-size:.95rem;opacity:.9;margin-bottom:10px}
    #popup-permission .pp-actions{display:flex;gap:10px;flex-wrap:wrap}
    #popup-permission .pp-actions button{
      border:0; border-radius:10px; padding:8px 12px; cursor:pointer;
      background:#fff;color:#111;font-weight:600;
    }
    #popup-permission #pp-help{background:#e9e9e9}
    #popup-permission #pp-close{background:#444;color:#fff;font-weight:500}
  </style>
</head>
<body>
  <header class="header">
    <nav class="nav" aria-label="주요">
      <!-- 왼쪽: DIAMO 로고 + 언어 버튼 -->
      <div class="nav-left">
        <div class="logo">DIAMO</div>
        <ul class="lang-switch" aria-label="언어 선택">
          <li><button type="button" data-lang="ko" class="active">KO</button></li>
          <li><button type="button" data-lang="en">EN</button></li>
          <li><button type="button" data-lang="jp">JP</button></li>
          <li><button type="button" data-lang="cn">CN</button></li>
        </ul>
      </div>
      <!-- 오른쪽: 문의하기 -->
      <ul class="nav-links">
        <li><a href="#" id="contact-link" aria-controls="contact-popup" aria-expanded="false">문의하기</a></li>
      </ul>
    </nav>
  </header>

  <section class="hero">
    <h1>Welcome to DIAMO</h1>
    <p>Unrivaled Ocean Views</p>
  </section>

  <section class="section" aria-labelledby="galleryTitle">
    <h2 id="galleryTitle">Gallery</h2>
    <div class="projects-grid">
      <div class="project" data-prefix="w" tabindex="0" role="button" aria-label="웨딩 갤러리 열기">
        <img class="thumb" src="https://raw.githubusercontent.com/Lamanujan/Diamo/main/images/w/hw.jpg" alt="웨딩" loading="eager" fetchpriority="high" decoding="async">
        <div class="project-label">웨딩</div>
      </div>
      <div class="project" data-prefix="b" tabindex="0" role="button" aria-label="돌잔치 갤러리 열기">
        <img class="thumb" src="https://raw.githubusercontent.com/Lamanujan/Diamo/main/images/b/hb.jpg" alt="돌잔치" loading="lazy" decoding="async">
        <div class="project-label">돌잔치</div>
      </div>
      <div class="project" data-prefix="s" tabindex="0" role="button" aria-label="칠순·팔순 갤러리 열기">
        <img class="thumb" src="https://raw.githubusercontent.com/Lamanujan/Diamo/main/images/s/hs.jpg" alt="칠순·팔순" loading="lazy" decoding="async">
        <div class="project-label">칠순·팔순</div>
      </div>
      <div class="project" data-prefix="m" tabindex="0" role="button" aria-label="모임/세미나 갤러리 열기">
        <img class="thumb" src="https://raw.githubusercontent.com/Lamanujan/Diamo/main/images/m/hm.jpg" alt="모임/세미나" loading="lazy" decoding="async">
        <div class="project-label">모임/세미나</div>
      </div>
      <div class="project" data-prefix="f10" tabindex="0" role="button" aria-label="10층 뷔페 갤러리 열기">
        <img class="thumb" src="https://raw.githubusercontent.com/Lamanujan/Diamo/main/images/f10/hf10.jpg" alt="10층 뷔페" loading="lazy" decoding="async">
        <div class="project-label">10층 뷔페</div>
      </div>
      <div class="project" data-prefix="f3" tabindex="0" role="button" aria-label="3층 뷔페 갤러리 열기">
        <img class="thumb" src="https://raw.githubusercontent.com/Lamanujan/Diamo/main/images/f3/hf3.jpg" alt="3층 뷔페" loading="lazy" decoding="async">
        <div class="project-label">3층 뷔페</div>
      </div>
    </div>
  </section>

  <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-hidden="true" aria-label="이미지 확대 보기">
    <button class="close-btn" id="closeBtn" aria-label="닫기">&times;</button>
    <div id="lightbox-container">
      <img id="lightbox-current" src="" alt="확대 이미지">
      <img id="lightbox-next" src="" alt="" style="display:none">
      <button class="arrow left" id="prevBtn" aria-label="이전 이미지" type="button"><i class="fas fa-chevron-left" aria-hidden="true"></i></button>
      <button class="arrow right" id="nextBtn" aria-label="다음 이미지" type="button"><i class="fas fa-chevron-right" aria-hidden="true"></i></button>
    </div>
    <div class="dots" id="lightbox-dots" aria-label="페이지 표시 점"></div>
  </div>

  <div id="contact-popup" role="dialog" aria-modal="true" aria-label="문의하기">
    <h3 id="contact-title" style="margin-bottom:8px">문의하기</h3>
    <input id="contact-name" type="text" placeholder="이름" aria-label="이름">
    <input id="contact-phone" type="text" placeholder="전화번호" aria-label="전화번호">
    <textarea id="contact-message" placeholder="메시지를 입력하세요" rows="4" aria-label="메시지를 입력하세요"></textarea>
    <button id="contact-submit" onclick="sendEmail()">전송하기</button>
  </div>

  <div id="popup-permission" role="alertdialog" aria-modal="true" aria-live="assertive" aria-label="팝업 차단 안내" hidden>
    <div class="pp-wrap">
      <strong>팝업이 차단되었습니다.</strong>
      <p>브라우저 설정에서 이 사이트의 팝업을 허용해 주세요. 허용 후 아래 버튼으로 다시 시도할 수 있어요.</p>
      <div class="pp-actions">
        <button type="button" id="pp-try">다시 시도</button>
        <button type="button" id="pp-help">브라우저별 허용 방법</button>
        <button type="button" id="pp-close" aria-label="안내 닫기">닫기</button>
      </div>
    </div>
  </div>

  <div class="footer-icons" aria-label="바로가기">
    <a href="https://www.instagram.com/_eldkah/" target="_blank" rel="noreferrer noopener" class="instagram" aria-label="인스타그램 이동"><i class="fab fa-instagram"></i></a>
    <a href="https://m.blog.naver.com/qowlans1211" target="_blank" rel="noreferrer noopener" class="blog" aria-label="네이버 블로그 이동"><i class="fas fa-blog"></i></a>
  </div>
  <footer class="footer">
    <div class="footer-copy">© 2025 DIAMO. All rights reserved.</div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js" defer></script>
  <script>
  (() => {
    const EMAILJS = { publicKey:'9YqLj0sQHeKA9XkIJ', serviceId:'service_12ehn7t', templateId:'template_2jcmp9n' };
    const counts = { w:43, b:46, s:69, m:52, f10:33, f3:18 };
    const exts   = { w:'jpg', b:'jpg', s:'jpg', m:'jpg', f10:'jpg', f3:'jpg' };
    const VISIBLE_DOTS = 7;

    const lightbox    = document.getElementById('lightbox');
    const lbContainer = document.getElementById('lightbox-container');
    const imgCurr     = document.getElementById('lightbox-current');
    const imgNext     = document.getElementById('lightbox-next');
    const dotsWrap    = document.getElementById('lightbox-dots');
    const prevBtn     = document.getElementById('prevBtn');
    const nextBtn     = document.getElementById('nextBtn');
    const closeBtn    = document.getElementById('closeBtn');
    const contactLink = document.getElementById('contact-link');
    const contactPopup= document.getElementById('contact-popup');

    const initEmail = () => { try { emailjs.init(EMAILJS.publicKey); } catch(e){} };

    /* ── 다국어 텍스트 정의 ───────────────────────── */
    const I18N = {
      ko: {
        gallery: ['웨딩','돌잔치','칠순·팔순','모임/세미나','10층 뷔페','3층 뷔페'],
        contactLink: '문의하기',
        contactTitle: '문의하기',
        namePlaceholder: '이름',
        phonePlaceholder: '전화번호',
        messagePlaceholder: '메시지를 입력하세요',
        submitText: '전송하기'
      },
      en: {
        gallery: ['Wedding','1st Birthday','70th·80th','Events / Seminar','10F Buffet','3F Buffet'],
        contactLink: 'Contact',
        contactTitle: 'Contact',
        namePlaceholder: 'Name',
        phonePlaceholder: 'Phone Number',
        messagePlaceholder: 'Please enter your message',
        submitText: 'Send'
      },
      jp: {
        gallery: ['ウェディング','1歳誕生日','古希・傘寿','会食 / セミナー','10階ビュッフェ','3階ビュッフェ'],
        contactLink: 'お問い合わせ',
        contactTitle: 'お問い合わせ',
        namePlaceholder: 'お名前',
        phonePlaceholder: '電話番号',
        messagePlaceholder: 'メッセージをご入力ください',
        submitText: '送信'
      },
      cn: {
        gallery: ['婚礼','周岁宴','古稀·八十寿宴','聚会 / 说明会','10层自助餐','3层自助餐'],
        contactLink: '咨询',
        contactTitle: '咨询',
        namePlaceholder: '姓名',
        phonePlaceholder: '电话',
        messagePlaceholder: '请输入您的留言',
        submitText: '发送'
      }
    };

    function setLanguage(lang){
      const dict = I18N[lang] || I18N.ko;

      // Gallery 라벨
      const labels = document.querySelectorAll('.project-label');
      labels.forEach((el, idx) => {
        if (dict.gallery[idx]) el.textContent = dict.gallery[idx];
      });

      // 헤더 문의하기
      if (contactLink) contactLink.textContent = dict.contactLink;

      // 팝업 내부 텍스트들
      const titleEl  = document.getElementById('contact-title');
      const nameEl   = document.getElementById('contact-name');
      const phoneEl  = document.getElementById('contact-phone');
      const msgEl    = document.getElementById('contact-message');
      const submitEl = document.getElementById('contact-submit');

      if (titleEl)  titleEl.textContent = dict.contactTitle;
      if (contactPopup) contactPopup.setAttribute('aria-label', dict.contactTitle);
      if (nameEl){
        nameEl.placeholder = dict.namePlaceholder;
        nameEl.setAttribute('aria-label', dict.namePlaceholder);
      }
      if (phoneEl){
        phoneEl.placeholder = dict.phonePlaceholder;
        phoneEl.setAttribute('aria-label', dict.phonePlaceholder);
      }
      if (msgEl){
        msgEl.placeholder = dict.messagePlaceholder;
        msgEl.setAttribute('aria-label', dict.messagePlaceholder);
      }
      if (submitEl) submitEl.textContent = dict.submitText;

      // 활성 언어 버튼 표시
      document.querySelectorAll('.lang-switch button').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
      });
    }

    function closeLightbox(){
      lightbox.setAttribute('aria-hidden','true');
      lightbox.style.display = 'none';
      if (history.state && history.state.lightbox) history.back();
    }
    function closeContact(){
      contactPopup.classList.remove('open');
      contactLink.setAttribute('aria-expanded','false');
    }
    window.closeContact = closeContact;

    let galleryImages = [];
    let galleryIndex  = 0;
    let isAnimating   = false;
    let swipe = { startX:0, endX:0, startY:0, endY:0, width:0, attached:false };

    const makeURL = (prefix, i) => `https://raw.githubusercontent.com/Lamanujan/Diamo/main/images/${prefix}/${prefix} (${i}).${exts[prefix]}`;

    function updateDots(){
      dotsWrap.innerHTML = '';
      const total = galleryImages.length;
      const half  = Math.floor(VISIBLE_DOTS/2);
      let start   = Math.max(0, galleryIndex - half);
      if (start + VISIBLE_DOTS > total) start = Math.max(total - VISIBLE_DOTS, 0);
      const end   = Math.min(total, start + VISIBLE_DOTS);
      for (let i = start; i < end; i++){
        const dot = document.createElement('span');
        if (i === galleryIndex) dot.classList.add('active');
        dot.addEventListener('click', () => showImage(i), {passive:true});
        dotsWrap.appendChild(dot);
      }
    }

    function prefetchAround(idx){
      if (!galleryImages.length) return;
      const p = (idx - 1 + galleryImages.length) % galleryImages.length;
      const n = (idx + 1) % galleryImages.length;
      [p, n].forEach(i => { const im = new Image(); im.loading = "eager"; im.src = galleryImages[i]; });
    }

    function showImage(idx){
      galleryIndex = idx;
      imgCurr.src = galleryImages[idx];
      updateDots();
      prefetchAround(idx);
    }

    function slide(dir){
      if (isAnimating || galleryImages.length <= 1) return;
      isAnimating = true;
      const newIdx = (galleryIndex + dir + galleryImages.length) % galleryImages.length;
      imgNext.src  = galleryImages[newIdx];
      imgNext.style.display = 'block';
      imgNext.style.transition = 'none';
      imgNext.style.transform  = `translateX(${dir>0?100:-100}%)`;
      imgNext.style.opacity    = '0';
      void imgNext.offsetWidth;
      const trans = `transform var(--speed) ease-out, opacity var(--speed) ease-out`;
      imgCurr.style.transition = trans;
      imgNext.style.transition = trans;
      imgCurr.style.transform = `translateX(${dir>0?-100:100}%)`;
      imgCurr.style.opacity   = '0';
      imgNext.style.transform = 'translateX(0)';
      imgNext.style.opacity   = '1';
      const finish = () => {
        imgCurr.src = imgNext.src;
        imgCurr.style.transition = 'none';
        imgCurr.style.transform  = 'none';
        imgCurr.style.opacity    = '1';
        imgNext.style.display    = 'none';
        galleryIndex = newIdx;
        updateDots();
        isAnimating = false;
        prefetchAround(galleryIndex);
      };
      imgNext.addEventListener('transitionend', e => { if (e.propertyName === 'transform') finish(); }, {once:true});
      setTimeout(()=>{ if(isAnimating) finish(); }, 550);
    }

    function openGallery(prefix){
      const total = counts[prefix] ?? 0;
      if (total <= 0){ alert(`${prefix} 폴더에 표시할 이미지가 없습니다.`); return; }
      galleryImages = Array.from({length: total}, (_, i) => makeURL(prefix, i+1));
      galleryIndex  = 0;
      imgCurr.style.transition = 'none';
      imgNext.style.transition = 'none';
      imgCurr.style.transform  = 'none';
      imgNext.style.transform  = 'none';
      imgCurr.style.opacity    = '1';
      imgNext.style.opacity    = '0';
      imgNext.style.display    = 'none';
      showImage(0);
      lightbox.setAttribute('aria-hidden','false');
      lightbox.style.display='flex';
      history.pushState({lightbox:true}, '');
      if (!swipe.attached){
        swipe.attached = true;
        lbContainer.addEventListener('touchstart', e=>{
          const t = e.touches[0];
          swipe.startX = t.clientX;
          swipe.endX   = t.clientX;
          swipe.startY = t.clientY;
          swipe.endY   = t.clientY;
          swipe.width  = lbContainer.clientWidth;
        }, {passive:true});
        lbContainer.addEventListener('touchmove', e=>{
          const t = e.touches[0];
          swipe.endX = t.clientX;
          swipe.endY = t.clientY;
        }, {passive:true});
        lbContainer.addEventListener('touchend', ()=>{
          const dx = swipe.endX - swipe.startX;
          const dy = swipe.endY - swipe.startY;
          const threshold = Math.max(40, swipe.width * .18);
          if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > threshold){
            dx > 0 ? slide(-1) : slide(1);
          }
        }, {passive:true});
      }
    }

    function initRevealOnScroll(){
      const thumbs = document.querySelectorAll('.thumb');
      thumbs.forEach(img => img.classList.add('reveal'));
      const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (reduce){ thumbs.forEach(img => img.classList.add('in')); return; }
      const io = new IntersectionObserver((entries, obs)=>{
        entries.forEach(e=>{
          if (e.isIntersecting){ e.target.classList.add('in'); obs.unobserve(e.target); }
        });
      }, { threshold: .15 });
      thumbs.forEach(img => io.observe(img));
    }

    function bindOnce(){
      document.querySelectorAll('.project').forEach(el=>{
        const prefix = el.dataset.prefix;
        el.addEventListener('click', ()=> openGallery(prefix));
        el.addEventListener('keydown', e=>{ if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openGallery(prefix); } });
      });
      prevBtn.addEventListener('click', ()=> slide(-1));
      nextBtn.addEventListener('click', ()=> slide(1));
      closeBtn.addEventListener('click', closeLightbox);
      lightbox.addEventListener('click', e=>{ if (e.target === lightbox) closeLightbox(); });
      document.addEventListener('keydown', e=>{
        const visible = lightbox.getAttribute('aria-hidden') === 'false';
        if (!visible) return;
        if (e.key === 'ArrowLeft')  slide(-1);
        if (e.key === 'ArrowRight') slide(1);
        if (e.key === 'Escape')     closeLightbox();
      });
      window.addEventListener('popstate', ()=>{
        if (lightbox.getAttribute('aria-hidden') === 'false') closeLightbox();
        closeContact();
      });
      contactLink.addEventListener('click', e=>{
        e.preventDefault();
        const willOpen = !contactPopup.classList.contains('open');
        contactPopup.classList.toggle('open');
        contactLink.setAttribute('aria-expanded', String(willOpen));
      });
      document.addEventListener('click', (e) => {
        const isOpen = contactPopup.classList.contains('open');
        if (!isOpen) return;
        const insidePopup = contactPopup.contains(e.target);
        const onToggle    = e.target === contactLink || contactLink.contains(e.target);
        if (!insidePopup && !onToggle) closeContact();
      }, { capture: true });
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && contactPopup.classList.contains('open')) closeContact();
      });

      // 언어 버튼 클릭 처리
      document.querySelectorAll('.lang-switch button').forEach(btn => {
        btn.addEventListener('click', () => {
          setLanguage(btn.dataset.lang);
        });
      });

      // 기본 언어: 한국어
      setLanguage('ko');
    }

    document.addEventListener('DOMContentLoaded', () => {
      bindOnce();
      if ('requestIdleCallback' in window) {
        requestIdleCallback(initRevealOnScroll, { timeout: 500 });
        requestIdleCallback(initEmail);
      } else {
        setTimeout(initRevealOnScroll, 0);
        setTimeout(initEmail, 0);
      }
    });

    (function(){
      const banner   = document.getElementById('popup-permission');
      const btnTry   = document.getElementById('pp-try');
      const btnHelp  = document.getElementById('pp-help');
      const btnClose = document.getElementById('pp-close');

      function isPopupBlocked(win){
        return !win || win.closed || typeof win.closed === 'undefined';
      }
      function showBanner(){ banner.hidden = false; }
      function hideBanner(){ banner.hidden = true; }
      function showHelp(){
        alert('팝업 허용 방법(요약)\n- Chrome: 주소창 오른쪽 팝업 아이콘 또는 사이트 정보(자물쇠) > 사이트 설정 > 팝업/리디렉션 허용\n- Edge: 사이트 정보(자물쇠) > 사이트 권한 > 팝업/리디렉션 허용\n- Safari(macOS): Safari > 설정 > 웹사이트 > 팝업 윈도우 > 해당 사이트 허용\n- 모바일 브라우저도 유사한 위치에 팝업/리디렉션 항목이 있습니다.');
      }
      if (btnHelp)  btnHelp.addEventListener('click', showHelp);
      if (btnClose) btnClose.addEventListener('click', hideBanner);

      window.tryOpenPopup = function(openFn){
        try{
          const test = window.open('', '', 'width=1,height=1,left=-10000,top=-10000');
          if (isPopupBlocked(test)){
            showBanner();
            if (btnTry) btnTry.onclick = () => { hideBanner(); if (openFn) openFn(); };
            return false;
          } else {
            test.close();
            if (openFn) openFn();
            return true;
          }
        }catch(e){
          showBanner();
          return false;
        }
      };
    })();

    window.sendEmail = async function(){
      const popup = document.getElementById('contact-popup');
      const inputs = popup.querySelectorAll('input, textarea');
      const nameEl = document.getElementById('contact-name');
      const phoneEl = document.getElementById('contact-phone');
      const msgEl = document.getElementById('contact-message');
      const submitBtn = document.getElementById('contact-submit');

      const name = (nameEl?.value || '').trim();
      const phone = (phoneEl?.value || '').trim();
      const message = (msgEl?.value || '').trim();

      if (!name || !phone || !message){
        alert('이름, 전화번호, 메시지를 모두 입력해주세요.');
        return;
      }

      inputs.forEach(el => el.disabled = true);
      submitBtn.disabled = true;
      const prevText = submitBtn.textContent;
      submitBtn.textContent = '전송 중...';

      try{
        await emailjs.send(EMAILJS.serviceId, EMAILJS.templateId, {
          name,
          from_name: name,
          contact_number: phone,
          message,
          page_url: location.href,
          user_agent: navigator.userAgent,
          sent_at: new Date().toISOString()
        });
        submitBtn.textContent = '전송 완료';
        alert('문의가 정상 접수되었습니다. 곧 연락드리겠습니다.');
        nameEl.value = ''; phoneEl.value = ''; msgEl.value = '';
        closeContact();
      } catch (err){
        alert('전송에 실패했습니다. 네트워크 상태를 확인 후 다시 시도해주세요.');
        submitBtn.textContent = prevText;
      } finally{
        inputs.forEach(el => el.disabled = false);
        submitBtn.disabled = false;
      }
    };
  })();
  </script>
</body>
</html>
